#!groovy

node('build-slave') {

	currentBuild.result = "SUCCESS"

	try {

		stage('checkout')
		{
			// sh('rm -rf sunbird-auth')
			// sh('git clone https://github.com/ahghatol/sunbird-auth.git')
			sh('ls')
		}

		stage('Build'){
			dir('sunbird-auth')
			{
				sh("ls");
				sh("echo sunbird-auth");
				sh('cat keycloak/scripts/pipelines/keycloak-build/Jenkinsfile.dev');
			}

			dir('scripts'){
				sh('ls');
				sh("echo in script");
				sh('cat pipelines/keycloak-build/Jenkinsfile.dev');
				//sh('cd ansible && ansible-playbook -i inventories/dev  keycloak.yml --limit localhost --tags build --vault-password-file /home/ops/vault -vvv')
			}
		}

		stage('Archive'){
			sh('cp sunbird-auth/keycloak/scripts/ansible/sunbird_auth_1.0v.zip .')
			archiveArtifacts 'sunbird_auth_1.0v.zip'
		}
	}
	catch (err) {
		currentBuild.result = "FAILURE"
		throw err
	}
}
